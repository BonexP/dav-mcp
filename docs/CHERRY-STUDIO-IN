# Cherry Studio DAV-MCP é›†æˆæŒ‡å—

æœ¬æ–‡æ¡£å¸®åŠ©è§£å†³Cherry Studioé›†æˆDAV-MCPæœåŠ¡å™¨æ—¶é‡åˆ°çš„"Connection closed"é”™è¯¯ã€‚

## ðŸš€ å¿«é€Ÿå¼€å§‹

### 1. çŽ¯å¢ƒå‡†å¤‡

ç¡®ä¿å®‰è£…äº†Node.js 18+ï¼š
```bash
node --version
```

### 2. æœåŠ¡å™¨é…ç½®

åœ¨Cherry Studioçš„MCPè®¾ç½®ä¸­æ·»åŠ ï¼š

```json
{
  "name": "dav-mcp",
  "command": "node",
  "args": ["/absolute/path/to/dav-mcp/src/server-stdio.js"],
  "env": {
    "CALDAV_SERVER_URL": "https://dav.yourserver.com",
    "CALDAV_USERNAME": "your_username",
    "CALDAV_PASSWORD": "your_password",
    "MCP_SERVER_NAME": "dav-mcp",
    "MCP_SERVER_VERSION": "2.7.0",
    "LOG_LEVEL": "info"
  }
}
```

### 3. æµ‹è¯•è¿žæŽ¥

æ·»åŠ åŽï¼ŒCherry Studioåº”è¯¥èƒ½å¤Ÿï¼š
- æˆåŠŸå¯åŠ¨æœåŠ¡å™¨
- åˆ—å‡º26ä¸ªå¯ç”¨å·¥å…·
- æ‰§è¡ŒåŸºæœ¬çš„CalDAVæ“ä½œ

## ðŸ”§ æ•…éšœæŽ’é™¤

### å¸¸è§é”™è¯¯å’Œè§£å†³æ–¹æ¡ˆ

#### 1. "Connection closed" é”™è¯¯

**ç—‡çŠ¶**: Cherry Studioæ˜¾ç¤º"Error invoking remote method 'mcp:list-tools': MCP error -32000: Connection closed."

**åŽŸå› **: 
- çŽ¯å¢ƒå˜é‡ç¼ºå¤±å¯¼è‡´å¯åŠ¨å¤±è´¥
- CalDAVæœåŠ¡å™¨è¿žæŽ¥å¤±è´¥
- ä¾èµ–æ¨¡å—åŠ è½½é”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
```bash
# 1. é¦–å…ˆæ‰‹åŠ¨æµ‹è¯•æœåŠ¡å™¨å¯åŠ¨
cd /path/to/dav-mcp
export CALDAV_SERVER_URL="https://dav.example.com"
export CALDAV_USERNAME="test"
export CALDAV_PASSWORD="test"
node src/server-stdio.js

# 2. å¦‚æžœæœ‰é”™è¯¯è¾“å‡ºï¼Œè¯·æ£€æŸ¥ï¼š
# - Node.jsç‰ˆæœ¬ (éœ€è¦18+)
# - ä¾èµ–æ˜¯å¦æ­£ç¡®å®‰è£…
# - çŽ¯å¢ƒå˜é‡æ ¼å¼
```

#### 2. "Module not found" é”™è¯¯

**ç—‡çŠ¶**: `Cannot find module '@modelcontextprotocol/sdk'`

**è§£å†³æ–¹æ¡ˆ**:
```bash
# é‡æ–°å®‰è£…ä¾èµ–
cd /path/to/dav-mcp
npm install
```

#### 3. CalDAVè®¤è¯å¤±è´¥

**ç—‡çŠ¶**: å·¥å…·æ‰§è¡Œæ—¶å‡ºçŽ°401 Unauthorizedé”™è¯¯

**è§£å†³æ–¹æ¡ˆ**:
1. æ£€æŸ¥CalDAVæœåŠ¡å™¨URLæ˜¯å¦æ­£ç¡®
2. éªŒè¯ç”¨æˆ·åå¯†ç 
3. ç¡®è®¤CalDAVæœåŠ¡å™¨æ”¯æŒBasic Auth

#### 4. æœåŠ¡å™¨å¯åŠ¨ä½†å·¥å…·å¤±è´¥

**ç—‡çŠ¶**: æœåŠ¡å™¨å¯åŠ¨æˆåŠŸï¼Œä½†å·¥å…·è°ƒç”¨å¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
```bash
# å¯ç”¨è¯¦ç»†æ—¥å¿—
export LOG_LEVEL=debug
export NODE_ENV=development
node src/server-stdio.js
```

## ðŸ“ æœ€å°é…ç½®

å¦‚æžœä¸Šè¿°é…ç½®ä»æœ‰é—®é¢˜ï¼Œå¯ä»¥ä½¿ç”¨æœ€å°é…ç½®è¿›è¡Œæµ‹è¯•ï¼š

```json
{
  "name": "dav-mcp-test",
  "command": "node",
  "args": ["/absolute/path/to/dav-mcp/src/server-stdio.js"],
  "env": {
    "AUTH_METHOD": "Dummy",
    "MCP_SERVER_NAME": "dav-mcp-test",
    "MCP_SERVER_VERSION": "2.7.0"
  }
}
```

**æ³¨æ„**: `AUTH_METHOD=Dummy`ä»…ç”¨äºŽæµ‹è¯•ï¼ŒæœåŠ¡å™¨ä¼šå¯åŠ¨ä½†æ— æ³•æ‰§è¡Œå®žé™…çš„CalDAVæ“ä½œã€‚

## ðŸ” è°ƒè¯•æ­¥éª¤

### æ­¥éª¤1: éªŒè¯æœåŠ¡å™¨

```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /path/to/dav-mcp

# åˆ›å»º.envæ–‡ä»¶
cat > .env << EOF
CALDAV_SERVER_URL=https://dav.yourserver.com
CALDAV_USERNAME=your_username
CALDAV_PASSWORD=your_password
MCP_SERVER_NAME=dav-mcp
MCP_SERVER_VERSION=2.7.0
LOG_LEVEL=debug
NODE_ENV=development
EOF

# æµ‹è¯•å¯åŠ¨
node src/server-stdio.js
```

### æ­¥éª¤2: æ£€æŸ¥è¾“å‡º

å¯åŠ¨æˆåŠŸæ—¶åº”è¯¥çœ‹åˆ°ï¼š
```
[DAV-MCP] Starting STDIO server...
[DAV-MCP] âœ… Server started successfully!
[DAV-MCP] Server: dav-mcp v2.7.0
[DAV-MCP] Transport: stdio
[DAV-MCP] Tools: 26 (Calendar: 11, Contacts: 8, Todos: 7)
```

### æ­¥éª¤3: æµ‹è¯•å·¥å…·è°ƒç”¨

åœ¨å¦ä¸€ä¸ªç»ˆç«¯æµ‹è¯•ï¼š
```bash
echo '{"jsonrpc":"2.0","id":1,"method":"tools/list","params":{}}' | node src/server-stdio.js
```

åº”è¯¥è¿”å›žåŒ…å«26ä¸ªå·¥å…·çš„JSONå“åº”ã€‚

## ðŸŽ¯ CalDAVæœåŠ¡å™¨é…ç½®ç¤ºä¾‹

### Nextcloud

```json
{
  "CALDAV_SERVER_URL": "https://your-nextcloud.com/remote.php/dav/",
  "CALDAV_USERNAME": "your_username",
  "CALDAV_PASSWORD": "your_password"
}
```

### Baikal

```json
{
  "CALDAV_SERVER_URL": "https://your-baikal.com/dav.php/",
  "CALDAV_USERNAME": "your_username", 
  "CALDAV_PASSWORD": "your_password"
}
```

### Radicale

```json
{
  "CALDAV_SERVER_URL": "https://your-radicale.com/",
  "CALDAV_USERNAME": "your_username",
  "CALDAV_PASSWORD": "your_password"
}
```

## ðŸ“Š å…¼å®¹æ€§æ£€æŸ¥

### æ”¯æŒçš„å®¢æˆ·ç«¯

- âœ… **Cherry Studio**: STDIOæ¨¡å¼
- âœ… **Claude Desktop**: STDIOæ¨¡å¼  
- âœ… **å…¶ä»–MCPå®¢æˆ·ç«¯**: å…¼å®¹æ ‡å‡†MCPåè®®çš„å®¢æˆ·ç«¯

### æ”¯æŒçš„CalDAVæœåŠ¡å™¨

- âœ… **Nextcloud**: å®Œå…¨æ”¯æŒ
- âœ… **Baikal**: å®Œå…¨æ”¯æŒ
- âœ… **Radicale**: å®Œå…¨æ”¯æŒ
- âœ… **Google Calendar**: OAuth2æ”¯æŒ
- âœ… **ä»»ä½•RFC 4791å…¼å®¹çš„CalDAVæœåŠ¡å™¨**

## ðŸ†˜ èŽ·å–å¸®åŠ©

å¦‚æžœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼š

1. **æ£€æŸ¥æ—¥å¿—**: æœåŠ¡å™¨å¯åŠ¨æ—¶æ˜¾ç¤ºçš„è¯¦ç»†é”™è¯¯ä¿¡æ¯
2. **éªŒè¯çŽ¯å¢ƒ**: Node.jsç‰ˆæœ¬ã€ä¾èµ–å®‰è£…ã€CalDAVè¿žæŽ¥
3. **ç®€åŒ–æµ‹è¯•**: ä½¿ç”¨`AUTH_METHOD=Dummy`è¿›è¡ŒåŸºç¡€æµ‹è¯•
4. **GitHub Issues**: [https://github.com/PhilflowIO/dav-mcp/issues](https://github.com/PhilflowIO/dav-mcp/issues)

## ðŸ“‹ å¿«é€Ÿæ£€æŸ¥æ¸…å•

- [ ] Node.js 18+å·²å®‰è£…
- [ ] é¡¹ç›®ä¾èµ–å·²æ­£ç¡®å®‰è£…
- [ ] CalDAVæœåŠ¡å™¨URLã€ç”¨æˆ·åã€å¯†ç å·²æ­£ç¡®é…ç½®
- [ ] æœåŠ¡å™¨èƒ½å¤Ÿç‹¬ç«‹å¯åŠ¨å¹¶æ˜¾ç¤ºæˆåŠŸä¿¡æ¯
- [ ] Cherry Studio MCPé…ç½®æ­£ç¡®æŒ‡å‘server-stdio.js
- [ ] çŽ¯å¢ƒå˜é‡æ­£ç¡®ä¼ é€’ç»™æœåŠ¡å™¨

æŒ‰ç…§æ­¤æŒ‡å—æ“ä½œï¼Œåº”è¯¥èƒ½å¤Ÿè§£å†³Cherry Studioé›†æˆé—®é¢˜ã€‚